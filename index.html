<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Recursive:slnt,wght,CASL,CRSV,MONO@-15..0,300..1000,0..1,0..1,0..1&display=swap"
      rel="stylesheet"
    />
    <script>
      window.SITEIFY_THEME_SELECTION_KEY = 'siteifyThemeSelection';
      var DEFAULT_ALTERNATE_THEME = 'haxor';

      function isSiteifySelections (v) {
        if (typeof v !== 'object' || v === null) return false;
        const { darkMode, alternateTheme } = v
        return [darkMode, alternateTheme].every((value) => typeof value === 'boolean');
      };

      function siteifySelections(userPrefersDark, secondaryToggleEnabled) {
        const DEFAULT_SELECTIONS = {
          darkMode: userPrefersDark,
          alternateTheme: false,
        };
        try {
          const selectionsString = localStorage.getItem(window.SITEIFY_THEME_SELECTION_KEY) || '';
          const selectionsObj = JSON.parse(selectionsString);
          if (isSiteifySelections(selectionsObj)) {
            return secondaryToggleEnabled ? selectionsObj : { ...selectionsObj, alternateTheme: false };
          } else {
            throw new Error('selections did not match expected shape');
          }
        } catch (e) {
          console.error(e)
          return DEFAULT_SELECTIONS;
        }
      }

      window.siteifyThemeConfig = function () {
        var userPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var siteifyConfig = window['SITEIFY_CONFIG']
        var { disabled: secondaryToggleDisabled, className: alternateThemeClass } = siteifyConfig?.secondaryToggle ?? {};
        var selections = siteifySelections(userPrefersDark, !secondaryToggleDisabled)
        return { siteifyConfig, alternateThemeClass: alternateThemeClass ?? DEFAULT_ALTERNATE_THEME, ...selections };
      }

      function initializeTheme() {
        var configResult = window.siteifyThemeConfig();
        if (configResult.darkMode) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.add('light')
        }
        if (!configResult.siteifyConfig?.secondaryToggle?.disabled && configResult.alternateTheme) {
          console.log('alternate theme??')
          document.documentElement.classList.add(configResult.alternateThemeClassName || DEFAULT_ALTERNATE_THEME)
        }
      }

      initializeTheme();
    </script>
    <style>
      body.hidden {
        visibility: hidden;
      }
    </style>
    <link rel="icon" type="image/svg+xml" href="/siteify/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Siteify</title>
    <script type="module" crossorigin src="/siteify/siteify.js"></script>
    <link rel="stylesheet" crossorigin href="/siteify/assets/siteify.css">
  </head>
  <body class="hidden">
    <div id="page">
      <main>
        <!-- CONTENT -->
      </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
